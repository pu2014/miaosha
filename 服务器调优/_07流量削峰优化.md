##流量削峰

问题
> 秒杀下单接口会被脚本不停的刷<br>
> 秒杀验证逻辑和秒杀下单接口强关联，代码冗余度高<br>
> 秒杀验证逻辑复杂，对交易系统产生无关联的负载<br>

##### 秒杀令牌
> 秒杀接口需要依靠令牌才能进入<br>
> 秒杀令牌由秒杀活动模块负责生成<br>
> 秒杀活动模块全权处理秒杀令牌，逻辑收口<br>
> 秒杀下单前用户需要拥有秒杀令牌<br>

##### 秒杀大闸原理
>依靠秒杀令牌的授权原理定制化发牌逻辑，做到大闸功能<br>
>根据秒杀商品初始库存颁发对应数量令牌，控制大闸流量<br>
>用户的风控策略前置到秒杀令牌放发中<br>
>库存售罄判断前置到秒杀令牌发放中<br>

问题：
>浪涌流量涌入后系统无法应对<br>
>多库存，多商品等令牌限制能力弱<br>

##### 队列泄洪
>排队有时候比并发更高效，没有cpu线程上下文切换（例如redis单线程模型，innodb mytex key等）<br>
>依靠排队限制并发流量<br>
>依靠排队和下游拥塞窗口程度调整队列释放流量大小<br>

部署：
>本地:维护再本地内存 多台服务器负载不一定完全均衡，很难保证机器都能收到下单的请求
>分布式：将队列设置到外部redis 便于整个集群管理，但是网络消耗和容易崩